{% extends 'pantry/base.html' %}
{% load staticfiles %}
{% load pantry_template_tags %}

{% block title_block %}
	Sign Up
{% endblock %}

{% block body_block %}
	<div class="logo">
		<img class="logo-welcome" src="{% static 'img/welcome.png' %}" alt="Welcome to the Pantry">
	</div>
	
	<div class="login-area">
		{% if registered %}
			<p class="login-prompt">You've registered successfully - you can now add and star recipes!</p><br />
			<form action="{% url 'pantry:user_profile' user.username %}" method="POST">
				{% csrf_token %}
				<input class="btn-continue" id="view-prof-btn" type="submit" value="View profile">
			</form>
		{% else %}
			<p class="login-prompt">Create your account here:</p>
			<form id="form-sign-up" method="post" action="{% url 'pantry:sign_up' %}" enctype="multipart/form-data" onsubmit="return validateCredentials()">
				{% csrf_token %}
				
				{{ user_form.username }}<br />
				{{ user_form.password }}<br />
				{{ user_form.confirm_password }}<br />
				{% if error %}
					<i class="error-message">{{ error }}</i><br />
				{% else %}
					<i class="error-message"></i><br />
				{% endif %}
				
				<button class="btn-back" type="button" onclick="history.back()">Back</button>
				<input class="btn-continue" type="submit" value="Continue" />
			</form>
		{% endif %}
	</div>

<script>
	function validateCredentials() {
		const usernamePattern = /^[\w.@+-]+$/;
		
		var username = document.getElementById("id_username").value;
		var password = document.getElementById("id_password").value;
		var confirmPassword = document.getElementById("id_confirm_password").value;
		var error = document.getElementsByClassName('error-message')[0];
		
		if (!usernamePattern.test(username)) {
			error.innerHTML = "Username may only contain letters, numbers, and @ . + - _ characters.";
			return false;
		} else if (password.length < 8) {
			error.innerHTML = "Password too short - it must contain at least 8 characters.";
			return false;
		} else if (!isNaN(password)) {
			error.innerHTML = "Password too simple - it must contain more than just numeric characters.";
			return false;
		} else if (password.toLowerCase() == username.toLowerCase()) {
			error.innerHTML = "Username and password too similar - try something different.";
			return false;
		} else if (password != confirmPassword) {
			error.innerHTML = "Passwords don't match - please try again.";
			return false;
		} else {
			return true;
		}
	}
</script>
{% endblock %}