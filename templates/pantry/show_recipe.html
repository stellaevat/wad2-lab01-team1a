{% extends 'pantry/base.html' %}
{% load staticfiles %}
{% load pantry_template_tags %}


{% block title_block %}
	{{ recipe.title }}
{% endblock %}

{% block body_block %}
	{% if recipe %}
	<div class="header-featured">
		<img class="banner" src="/media/{{ recipe.picture }}" alt="{{ recipe.title }}">
		<div class="banner-text">
			<h1 class="cat-heading" id="recipe-title">{{ recipe.title }}</h1>
			<div class="gap-small"></div>
			<div class="info-tags">
				<div class="tag">
					<strong class="recipe-tag-head">Preparation</strong>
					<p class="recipe-tag-info">{{ recipe.prep_time|format_time }}</p>
				</div>
				<div class="tag">
					<strong class="recipe-tag-head">Cooking</strong>
					<p class="recipe-tag-info">{{ recipe.cook_time|format_time }}</p>
				</div>
				<div class="tag">
					<strong class="recipe-tag-head">Difficulty</strong>
					<p class="recipe-tag-info">{{ recipe.difficulty }}</p>
				</div>
				<div class="tag">
					<strong class="recipe-tag-head">Servings</strong>
					<p class="recipe-tag-info">{{ recipe.servings }}</p>
				</div>
				<div class="tag">
					<img class="icon-big recipe-tag-head" src="{% static 'img/star-orange.png' %}" alt="Stars">
					<p class="recipe-tag-info" id="starinfo">{{ recipe.stars }}</p>
				</div>
			</div>
		</div>
		
		
		{% if user.is_authenticated and not user.is_staff %}
			{% if not user|check_if_starred:recipe %}
			<button class="btn-inverted" id="star-btn" type="button" onclick="star()">
				<span id="star-icon">&star;</span><span id="star-text">Star</span>
			</button>
			{% else %}
			<button class="btn-inverted" id="star-btn" type="button" onclick="unstar()">
				<span id="star-icon">&starf;</span><span id="star-text">Unstar</span>
			</button>
			{% endif %}
			{% if user == recipe.author %}
			<button class="btn-inverted" id="del-btn" type="button" onclick="confirm()">
				<span id="del-icon">&#128465;</span><span id="del-text">Delete</span>
			</button>
			{% endif %}
		{% endif %}
	</div>
	
	{% if categories %}
	<div class="category-tags">
		
		{% for cat in categories %}
		<a class="cat-tag" href="{% url 'pantry:show_category' cat.slug %}">{{ cat.name }}</a>
		{% endfor %}
	</div>
	{% endif %}
	
	<div class="verticals-left-narrow">
		<div>
			<div class="vertical-featured" id="ingredients">
				<h2 class="vertical-title">INGREDIENTS</h2></br>
				{% if ingredients %}
					<ul class="ingredient-list">
						{% for ing in ingredients %}
							<li class="ingredient">{{ ing.quantity }} {{ ing.ingredient|get_number:ing.plural }}</li>
						{% endfor %}
					</ul><br />
				{% else %}
					<p class="info-message">No ingredients required for this recipe!</p>
					<div class="gap-small"></div>
				{% endif %}
			</div>
		</div>
		<div class="vertical">
			<h2 class="vertical-title">METHOD</h2></br>
			<ol>
			{% for step in method %}
				{% if step %}
				<li class="long-text">{{ step }}</li><br />
				{% endif %}
			{% endfor %}
			</ol>
		</div>
	</div>
		
	{% else %}
	<h1 class="central-heading">We couldn't find this recipe...</h1>
	<p class="info-message">Maybe the author deleted it, or something went wrong - make sure you have the right link!</p>
	{% endif %}

	
<script>
	function star() {
		var username = "{{ user.username }}"
		var recipe_name_slug = "{{ recipe.title }}"
	  	

		$.ajax({
			url: 'star/' + username,
			data: {
          		'recipe_name_slug': recipe_name_slug,
				'username' : username
        	},
			dataType: 'json',
			success: function () {
				document.getElementById("star-btn").innerHTML = `<span id="star-icon">&starf;</span><span id="star-text">Unstar</span>`;
				document.getElementById("star-btn").setAttribute('onclick','unstar()');
				var counter = document.getElementById("starinfo").innerHTML;
				counter++;
				document.getElementById("starinfo").innerHTML = counter;
			}
		});

    };

	function unstar() {
		var username = "{{ user.username }}"
		var recipe_name_slug = "{{ recipe.title }}"
	  	

		$.ajax({
			url: 'unstar/' + username,
			data: {
          		'recipe_name_slug': recipe_name_slug,
				'username' : username
        	},
			dataType: 'json',
			success: function () {
				document.getElementById("star-btn").innerHTML = `<span id="star-icon">&star;</span><span id="star-text">Star</span>`;
				document.getElementById("star-btn").setAttribute('onclick','star()');
				var counter = document.getElementById("starinfo").innerHTML;
				counter--;
				document.getElementById("starinfo").innerHTML = counter;
			}
		});

    };

	function confirm() {
		document.getElementById("del-btn").innerHTML = `<span id="confirm-text">Confirm</span>`;
		document.getElementById("del-btn").style.backgroundColor = "red";
		document.getElementById("del-btn").style.color = "white";
		document.getElementById("del-btn").setAttribute("onclick","del()");

    };

	function del(){
		var username = "{{ user.username }}"
		var recipe_name_slug = "{{ recipe.title }}"


		$.ajax({
			url: 'delete_recipe/' + username,
			data: {
          		'recipe_name_slug': recipe_name_slug,
				'username' : username
        	},
			dataType: 'json',
			success: function () {
				window.location = "/pantry/home";
			}
		});
	}
	
</script>
{% endblock %}