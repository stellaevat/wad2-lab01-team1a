{% extends 'pantry/base.html' %}
{% load staticfiles %}
{% load pantry_template_tags %}


{% block title_block %}
	{{ recipe.title }}
{% endblock %}

{% block body_block %}
	{% if recipe %}
	<div class="header-featured">
		<img class="banner" src="/media/{{ recipe.picture }}" alt="{{ recipe.title }}">
		<div class="banner-text">
			<h1 class="cat-heading" id="recipe-title">{{ recipe.title }}</h1>
			<div class="gap-small"></div>
			<div class="info-tags">
				<div class="tag">
					<strong class="recipe-tag-head">Preparation</strong>
					<p class="recipe-tag-info">{{ recipe.prep_time }} min</p>
				</div>
				<div class="tag">
					<strong class="recipe-tag-head">Cooking</strong>
					<p class="recipe-tag-info">{{ recipe.cook_time }} min</p>
				</div>
				<div class="tag">
					<strong class="recipe-tag-head">Difficulty</strong>
					<p class="recipe-tag-info">{{ recipe.difficulty }}</p>
				</div>
				<div class="tag">
					<strong class="recipe-tag-head">Servings</strong>
					<p class="recipe-tag-info">{{ recipe.servings }}</p>
				</div>
				<div class="tag">
					<img class="icon-big recipe-tag-head" src="{% static 'img/star-orange.png' %}" alt="Stars">
					<p class="recipe-tag-info" id="starinfo">{{ recipe.stars }}</p>
				</div>
			</div>
		</div>
		
		
		{% if user.is_authenticated %}
			{% if not user|check_if_starred:recipe %}
			<button class="btn-inverted" id="star-btn" type="button" onclick="a()">
				<img class="icon-big" src="{% static 'img/star-dark.png' %}" alt="Star" id="starbuttonid">
				Star
			</button>
			{% else %}
			<button class="btn-inverted" id="star-btn" type="button" onclick="b()">
				<img class="icon-big" src="{% static 'img/star-dark.png' %}" alt="Unstar" id="starbuttonid">
				Unstar
			</button>
			{% endif %}
		{% endif %}
	</div>
	
	{% if categories %}
	<div class="category-tags">
		
		{% for cat in categories %}
		<a class="cat-tag" href="{% url 'pantry:show_category' cat.slug %}">{{ cat.name }}</a>
		{% endfor %}
	</div>
	{% endif %}
	
	<div class="verticals-left-narrow">
		<div>
			<div class="vertical-featured" id="ingredients">
				<h2 class="vertical-title">INGREDIENTS</h2></br>
				{% if ingredients %}
					<ul class="ingredient-list">
						{% for ing in ingredients %}
							<li class="ingredient">{{ ing.quantity }} {{ ing.ingredient.name }}</li>
						{% endfor %}
					</ul><br />
				{% else %}
					<p class="info-message">No ingredients required for this recipe!</p>
					<div class="gap-small"></div>
				{% endif %}
			</div>
		</div>
		<div class="vertical">
			<h2 class="vertical-title">METHOD</h2></br>
			<ol>
			{% for step in method %}
				<li class="long-text">{{ step }}</li><br />
			{% endfor %}
			</ol>
		</div>
	</div>
		
	{% else %}
	<h1 class="cat-heading">We couldn't find this recipe...</h1>
	<p class="info-message">Maybe the author deleted it, or something went wrong - make sure you have the right link!</p>
	{% endif %}

	<button onclick="change()">Click</button>

	
<script>
	function a() {
		var username = "{{ user.username }}"
		var recipe_name_slug = "{{ recipe.title }}"
	  	

		$.ajax({
			url: 'star/' + username,
			data: {
          		'recipe_name_slug': recipe_name_slug,
				'username' : username
        	},
			dataType: 'json',
			success: function () {
				document.getElementById("star-btn").innerHTML = `<img class="icon-big" src="{% static 'img/star-dark.png' %}" alt="Unstar" id="starbuttonid">
				Unstar`;
				document.getElementById("star-btn").setAttribute('onclick','b()');
				var counter = document.getElementById("starinfo").innerHTML;
				counter++;
				document.getElementById("starinfo").innerHTML = counter;
			}
		});

    };

	function b() {
		var username = "{{ user.username }}"
		var recipe_name_slug = "{{ recipe.title }}"
	  	

		$.ajax({
			url: 'unstar/' + username,
			data: {
          		'recipe_name_slug': recipe_name_slug,
				'username' : username
        	},
			dataType: 'json',
			success: function () {
				document.getElementById("star-btn").innerHTML = `<img class="icon-big" src="{% static 'img/star-dark.png' %}" alt="Star" id="starbuttonid">
				Star`
				document.getElementById("star-btn").setAttribute('onclick','a()')
				var counter = document.getElementById("starinfo").innerHTML;
				counter--;
				document.getElementById("starinfo").innerHTML = counter;
			}
		});

    };

	function change(){
		document.getElementById("star-btn").innerText = "Hello"
	};
</script>
{% endblock %}